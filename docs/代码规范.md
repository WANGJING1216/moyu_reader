# 摸鱼阅读 代码规范

## 1. 分支与发布规范
- 分支模型：`main`（发布） + `develop`（日常集成） + `feature/*`（功能开发）。
- 版本规范：`v主.次.补丁`，MVP 建议从 `v0.x` 起步。
- 合并门禁：PR 合并前必须通过 CI（静态检查、测试、构建）。

## 2. 代码质量规范
- 必开规则：`flutter_lints` + 自定义 `analysis_options.yaml`。
- 统一格式化：`dart format`。
- 提交信息：Conventional Commits（如 `feat:`, `fix:`, `refactor:`）。
- 关键路径（导入、跳章、老板键）必须具备测试覆盖。

## 3. 测试规范
- 单元测试：UseCase、章节解析、编码检测、进度恢复。
- Widget 测试：阅读页交互、目录高亮、菜单入口行为。
- 集成测试：首次导入阅读链路、老板键跳转、重启恢复进度。
- 性能测试：导入耗时、目录页打开耗时、低端机滚动帧率。

## 4. CI/CD 规范（GitHub Actions）
- CI 基础流水线：
  - `flutter pub get`
  - `dart analyze`
  - `flutter test --coverage`
  - Android Debug 构建校验
  - iOS 无签名构建校验
- CD（可选）：
  - TestFlight / 内测渠道自动分发
  - 版本号与变更日志自动生成

## 5. 架构约束
- Feature-first + Clean Architecture：`presentation -> application -> domain -> data`。
- 不允许跨层逆向依赖；UI 层不直接访问数据库或文件系统。
- 新增功能必须按模块落位，禁止把业务逻辑堆到 `shared/`。
