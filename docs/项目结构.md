# 摸鱼阅读 项目结构

## 当前已落地目录结构（P0-01 ~ P0-10）
```text
.
├── analysis_options.yaml
├── changeLog.log
├── docs
│   └── p0
│       ├── 00-总览与映射.md
│       ├── 01-技术设计.md
│       ├── 02-验收与测试.md
│       ├── 03-实施清单_工1_P0-04到P0-07.md
│       └── 04-实施清单_工1_P0-08到P0-10.md
├── pubspec.lock
├── pubspec.yaml
├── lib
│   ├── main.dart
│   ├── app
│   │   ├── app.dart
│   │   └── router.dart
│   └── features
│       ├── reader
│       │   ├── application
│       │   │   ├── reader_fake_data.dart
│       │   │   └── reader_progress_session_store.dart
│       │   ├── domain
│       │   │   └── entities
│       │   │       ├── fake_chat_message.dart
│       │   │       └── reading_progress.dart
│       │   └── presentation
│       │       └── pages
│       │           └── reader_page.dart
│       ├── bookshelf
│       │   └── presentation
│       │       └── pages
│       │           └── bookshelf_page.dart
│       ├── catalog
│       │   └── presentation
│       │       └── pages
│       │           └── catalog_page.dart
│       └── import_book
│           ├── application
│           │   └── use_cases
│           │       └── import_txt_book_use_case.dart
│           ├── data
│           │   └── repositories
│           │       └── local_txt_book_import_repository.dart
│           ├── domain
│           │   ├── entities
│           │   │   ├── import_book_exception.dart
│           │   │   └── imported_text_book.dart
│           │   └── repositories
│           │       └── book_import_repository.dart
│           └── presentation
│               └── pages
│                   └── import_book_page.dart
└── test
    ├── import_book_page_test.dart
    ├── p0_01_04_reader_test.dart
    ├── p0_08_10_catalog_test.dart
    ├── p0_11_13_progress_test.dart
    ├── p0_08_10_review_round2_test.dart
    ├── review_round1_fix_test.dart
    └── widget_test.dart

samples/
└── txt/
    ├── README.md
    ├── chaptered_example.txt
    └── plain_example.txt
```

## 新增文件与功能映射
- `lib/main.dart`：应用启动入口，挂载 `MoyuReaderApp`。
- `lib/app/app.dart`：`MaterialApp` 配置与初始路由（`/reader`）。
- `lib/app/router.dart`：路由定义与分发（`/reader`、`/catalog`、`/bookshelf`、`/import-book`）。
- `lib/features/reader/domain/entities/fake_chat_message.dart`：阅读伪装消息实体（角色/文本/头像/时间戳）。
- `lib/features/reader/domain/entities/reading_progress.dart`：阅读进度实体（`bookId/chapterIndex/innerOffset/outerOffset/updatedAt/readChapterIndexes`）。
- `lib/features/reader/application/reader_fake_data.dart`：阅读页静态聊天与小说正文假数据。
- `lib/features/reader/application/reader_progress_session_store.dart`：阅读会话状态容器（按 `bookId` 隔离当前章与已读集合，预留 P0-11~13 进度扩展接口）。
- `lib/features/reader/presentation/pages/reader_page.dart`：阅读主页面实现（P0-01~P0-04）：
  - 三层结构（顶部/聊天区/底部输入栏）
  - 大气泡内外嵌套滚动（内层优先、边界传递）
  - 静态伪装聊天区（头像+时间戳+双向消息）
  - 右上角 `···` 菜单及入口跳转
- `lib/shared/services/reading_progress_storage.dart`：阅读进度持久化服务（按 `bookId` 存储/恢复，坏数据兜底清理）。
- `lib/features/bookshelf/presentation/pages/bookshelf_page.dart`：书架入口占位页（P0-04 入口落地）。
- `lib/features/catalog/presentation/pages/catalog_page.dart`：目录页（P0-08~P0-10）：
  - 章节列表展示
  - 当前章自动定位与高亮
  - 已读/未读状态显示
  - 章节点击返回阅读页
- `lib/features/import_book/domain/entities/imported_text_book.dart`：导入结果实体（书名/正文/来源路径）。
- `lib/features/import_book/domain/entities/import_book_exception.dart`：导入异常定义（用于 UI 提示）。
- `lib/features/import_book/domain/repositories/book_import_repository.dart`：导入仓储抽象接口。
- `lib/features/import_book/application/use_cases/import_txt_book_use_case.dart`：导入用例层。
- `lib/features/import_book/data/repositories/local_txt_book_import_repository.dart`：本地 TXT 选择与读取实现（P0-05）。
- `lib/features/import_book/presentation/pages/import_book_page.dart`：导入页面（选择 TXT、失败提示、返回导入结果）。
- `test/p0_01_04_reader_test.dart`：P0-01~P0-04 最小测试集（结构、菜单、嵌套滚动场景）。
- `test/widget_test.dart`：应用启动冒烟测试（Reader 页面关键节点存在）。
- `test/import_book_page_test.dart`：P0-05 分支测试（导入成功/用户取消/导入失败）。
- `test/p0_08_10_catalog_test.dart`：P0-08~P0-10 目录与跳转测试（长按入口/章节跳转/状态展示）。
- `test/p0_11_13_progress_test.dart`：P0-11~P0-13 进度测试（持久化读写、坏数据兜底、章节+偏移恢复、生命周期保存）。
- `test/p0_08_10_review_round2_test.dart`：P0-08~P0-10 第2轮验收修复测试（路由转场时长、多书隔离接口）。
- `test/review_round1_fix_test.dart`：第1轮验收修复回归测试（单章解析、空参路由、坏数据兜底）。
- `docs/p0/03-实施清单_工1_P0-04到P0-07.md`：工1统一执行文档（P0-04/05/06/07 联动实施+验收+提交要求）。
- `docs/p0/04-实施清单_工1_P0-08到P0-10.md`：工1目录与跳转实施文档（P0-08/09/10）。
- `samples/txt/chaptered_example.txt`：标准章节导入样本。
- `samples/txt/plain_example.txt`：无章节导入样本。
- `samples/txt/README.md`：示例 TXT 使用说明。
- `pubspec.yaml`：Flutter 工程依赖定义。
- `analysis_options.yaml`：静态检查规则（基于 `flutter_lints`）。
- `pubspec.lock`：依赖锁定文件。
- `changeLog.log`：开发/整改/环境配置与验收记录。

## 分层说明（保持不变）
- `app/`：应用级入口、路由、全局主题。
- `core/`：跨模块基础能力与通用工具。
- `features/`：按业务能力拆分的功能模块（Feature-first）。
- `features/*/presentation`：页面、组件、状态展示层。
- `features/*/application`：用例与状态编排层。
- `features/*/domain`：实体与仓储接口定义层。
- `features/*/data`：本地存储、数据源实现层。
- `shared/`：通用 UI 组件与公共服务能力。

## 模块边界约束
- 禁止 `presentation` 直接依赖 `data`，必须通过 `application/domain`。
- `core` 不依赖任何 `features`，保持底层稳定性。
- 跨功能复用优先放 `shared`，避免复制代码。
