# 摸鱼阅读 需求技术文档全局索引

## 使用方法（省 token 版）
- 先确定你要查的范围：`产品需求`、`技术规范`、`某个需求包（如 P0）`。
- 再用关键字检索，不要整篇通读。

## 文档目录约定
- 产品文档目录：`产品文档/`
  - 当前：`产品文档/摸鱼阅读_PRD_v1.3.docx`、`产品文档/摸鱼阅读_PRD_v1.4.docx`
- 原型文档目录：`原型文档/`
  - 当前：`原型文档/moyureader-v2.html`
- 示例数据目录：`samples/txt/`
  - 当前：`samples/txt/chaptered_example.txt`、`samples/txt/plain_example.txt`
- 技术文档目录：`docs/`
  - 总索引：`docs/需求技术文档_全局索引.md`
  - 需求包索引：`docs/P0需求技术文档.md`（后续新增 `docs/xxx需求技术文档.md`）
  - 需求包分册目录：`docs/p0/`（后续新增 `docs/xxx/`）

## 快速检索命令
```bash
# 1) 查产品文档版本
rg -n "PRD|v1\\.[0-9]+" 产品文档 docs

# 2) 查某个需求包（例如 P0）
rg -n "P0-" docs/p0 docs/P0需求技术文档.md

# 3) 查技术主题（模块/路由/验收/数据）
rg -n "阅读核心|菜单与入口|路由|验收|数据" docs

# 4) 查实现与文档映射
rg -n "P0-01|P0-02|P0-03|P0-04" docs lib test

# 5) 查原型交互元素与脚本
rg -n "ctx-menu|font-sheet|reading-row|avatar|bubble-content|devicemotion" 原型文档/moyureader-v2.html

# 6) 查导入联调用示例TXT
rg -n "第[0-9]+章|示例文本|降级策略" samples/txt
```

## 新需求文档规范（统一流程）
后续每次新需求，统一仿造 `P0需求技术文档`：

1. 新建需求总索引
- 文件：`docs/xxx需求技术文档.md`
- 内容结构建议：
  - 使用方法（省 token）
  - 快速检索命令
  - 推荐阅读顺序
  - 维护规则

2. 新建分册目录
- 目录：`docs/xxx/`
- 最少 3 个文件：
  - `docs/xxx/00-总览与映射.md`
  - `docs/xxx/01-技术设计.md`
  - `docs/xxx/02-验收与测试.md`

3. 建立编号映射
- 在 `00-总览与映射.md` 中维护 `xxx-01 ~ xxx-n` 与 PRD章节映射。
- 新增功能先改映射，再改实现和测试。

## 工程师需求单结构（工1统一模板）
给工程师的需求单（实施清单）统一采用四大块：
1. 基础需求（固定区）
- 目标与范围、参考资料、强制要求、开发步骤、提交规范、初始验收用例。
2. 第1轮验收结果
- 验收结论、问题清单、修复Checklist、复验Checklist。
3. 第N轮验收结构（可复制追加）
- 每轮只追加，不覆盖历史，直到问题全部闭环。
4. 最终验收通过标准
- 封板条件、质量门禁、文档与日志一致性要求。

## 推荐阅读顺序（按任务）
- 做功能：先看 `00-总览与映射.md`，再看 `01-技术设计.md`。
- 做联调：先看路由和数据结构，再看验收指标。
- 做测试：直接看 `02-验收与测试.md` 用例与门禁。

## 维护规则
- PRD 更新：先更新 `产品文档/`，再更新对应 `docs/xxx` 映射与验收。
- 需求变更：只改对应 `xxx` 需求包，避免跨包混改。
- 所有修复与结论同步到 `changeLog.log`。

## 提交规范（团队统一遵守）

### 分支规范
- `main`：稳定主干，仅通过评审后合入。
- `feature/*`：功能开发分支（示例：`feature/p0-import-parser`）。
- `fix/*`：缺陷修复分支（示例：`fix/p0-import-crash`）。

### Commit Message 规范
- 统一使用 Conventional Commits：
  - `feat:` 新功能
  - `fix:` 缺陷修复
  - `refactor:` 重构（不改行为）
  - `test:` 测试补充
  - `docs:` 文档修改
  - `chore:` 工程杂项
- 示例：
  - `feat(import): support utf8/gbk decode fallback`
  - `fix(reader): handle import cancel without state mutation`

### 提交前检查（必须）
- 运行：
```bash
/Users/wangjing/tools/flutter-sdk/bin/flutter analyze
NO_PROXY=127.0.0.1,localhost /Users/wangjing/tools/flutter-sdk/bin/flutter test
```
- 检查范围：
  - 仅提交本次需求相关改动，避免混入无关文件。
  - 不提交本地产物（见 `.gitignore`）。

### changeLog 记录要求（必须）
- 每次提交前后在 `changeLog.log` 记录：
  - 时间、修改人、范围（P0-xx）
  - 变更文件与功能点
  - 验证结果（analyze/test/手工用例）
  - 未完成项与范围外说明

### Git Hook（已接入）
- 版本化 hooks 目录：`.githooks/`
- 已提供脚本：
  - `.githooks/pre-commit`：提交前执行 `flutter analyze` + `flutter test`
  - `.githooks/commit-msg`：校验 Conventional Commits 格式
  - `scripts/setup-git-hooks.sh`：一键启用 hooks
- 启用命令：
```bash
./scripts/setup-git-hooks.sh
```
- 临时跳过 pre-commit（仅紧急场景）：
```bash
git commit --no-verify -m "chore: emergency commit"
```
