<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ‘¸é±¼é˜…è¯» Â· PRD v1.3 äº¤äº’åŸå‹</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

:root {
  --bg: #EDEDED;
  --white: #FFFFFF;
  --nav: #F7F7F7;
  --border: #E0E0E0;
  --txt: #1A1A1A;
  --muted: #888;
  --green: #07C160;
  --blue: #1A7FD4;
  --red: #FF3B30;
  --time-c: #ABABAB;
  --bubble-r: 4px 18px 18px 18px;
  --dur: 0.28s;
  --ease: cubic-bezier(0.4,0,0.2,1);
}

html, body {
  height: 100%;
  background: #111;
  font-family: -apple-system, 'PingFang SC', 'Noto Sans SC', sans-serif;
  overflow: hidden;
}

/* â”€â”€â”€ OUTER SHELL â”€â”€â”€ */
.shell {
  display: flex;
  height: 100vh;
  align-items: center;
  justify-content: center;
  gap: 0;
}

/* Left: Prototype Label */
.proto-meta {
  position: fixed;
  top: 24px;
  left: 50%;
  transform: translateX(-50%);
  text-align: center;
  z-index: 9999;
  pointer-events: none;
}
.proto-meta h1 {
  font-size: 13px;
  font-weight: 300;
  letter-spacing: 3px;
  color: #444;
  text-transform: uppercase;
}
.proto-meta span {
  font-size: 11px;
  color: #333;
  letter-spacing: 1px;
}

/* Flow map on side */
.flow-panel {
  position: fixed;
  right: 24px;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  flex-direction: column;
  gap: 6px;
  z-index: 9998;
}
.flow-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #333;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
}
.flow-dot.active { background: var(--green); transform: scale(1.4); }
.flow-dot::after {
  content: attr(data-label);
  position: absolute;
  right: 16px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 10px;
  color: #555;
  white-space: nowrap;
  opacity: 0;
  transition: opacity 0.2s;
}
.flow-dot:hover::after, .flow-dot.active::after { opacity: 1; }

/* â”€â”€â”€ PHONE â”€â”€â”€ */
.phone {
  width: 390px;
  height: 844px;
  background: var(--bg);
  border-radius: 52px;
  overflow: hidden;
  position: relative;
  box-shadow:
    0 0 0 1px #2A2A2A,
    0 0 0 10px #1E1E1E,
    0 40px 120px rgba(0,0,0,0.8);
  display: flex;
  flex-direction: column;
}

.dynamic-island {
  position: absolute;
  top: 12px;
  left: 50%;
  transform: translateX(-50%);
  width: 120px;
  height: 34px;
  background: #000;
  border-radius: 20px;
  z-index: 200;
  pointer-events: none;
}

/* â”€â”€â”€ SCREENS â”€â”€â”€ */
.screen {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  background: var(--bg);
  transition: transform var(--dur) var(--ease), opacity var(--dur) var(--ease);
  pointer-events: none;
  opacity: 0;
  transform: translateX(100%);
  border-radius: 52px;
  overflow: hidden;
}
.screen.active {
  pointer-events: all;
  opacity: 1;
  transform: translateX(0);
}
.screen.exit-left {
  transform: translateX(-30%);
  opacity: 0;
}
.screen.exit-right {
  transform: translateX(100%);
  opacity: 0;
}

/* â”€â”€â”€ STATUS BAR â”€â”€â”€ */
.status-bar {
  height: 54px;
  background: var(--nav);
  display: flex;
  align-items: flex-end;
  padding: 0 22px 8px;
  justify-content: space-between;
  flex-shrink: 0;
}
.status-bar.transparent { background: transparent; }
.s-time { font-size: 15px; font-weight: 600; color: var(--txt); }
.s-icons { display: flex; align-items: center; gap: 5px; }

/* â”€â”€â”€ NAV BAR â”€â”€â”€ */
.nav-bar {
  height: 44px;
  background: var(--nav);
  border-bottom: 0.5px solid var(--border);
  display: flex;
  align-items: center;
  padding: 0 16px;
  flex-shrink: 0;
  position: relative;
}
.nav-back {
  display: flex;
  align-items: center;
  color: var(--blue);
  font-size: 16px;
  cursor: pointer;
  padding: 8px 8px 8px 0;
  gap: 2px;
  z-index: 1;
}
.nav-center {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  flex-direction: column;
  align-items: center;
}
.nav-name { font-size: 17px; font-weight: 600; color: var(--txt); }
.nav-sub { font-size: 11px; color: var(--muted); }
.nav-more {
  position: absolute;
  right: 16px;
  cursor: pointer;
  padding: 8px;
  border-radius: 6px;
  transition: background 0.15s;
}
.nav-more:active { background: rgba(0,0,0,0.06); }

/* â”€â”€â”€ CHAT AREA â”€â”€â”€ */
.chat-area {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  background: var(--bg);
  padding: 12px 0 8px;
  display: flex;
  flex-direction: column;
  -webkit-overflow-scrolling: touch;
}
.chat-area::-webkit-scrollbar { display: none; }

.timestamp {
  text-align: center;
  font-size: 11px;
  color: var(--time-c);
  background: rgba(0,0,0,0.06);
  padding: 3px 10px;
  border-radius: 4px;
  display: inline-block;
  margin: 0 auto 12px;
  align-self: center;
  flex-shrink: 0;
}

.msg-row {
  display: flex;
  align-items: flex-start;
  padding: 4px 12px;
}

.avatar {
  width: 40px;
  height: 40px;
  border-radius: 6px;
  flex-shrink: 0;
  background: linear-gradient(135deg, #F8BBD9, #CE93D8, #9FA8DA);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  cursor: pointer;
  user-select: none;
  position: relative;
  transition: transform 0.1s;
}
.avatar:active { transform: scale(0.94); }

.bubble-wrap { flex: 1; padding-left: 10px; max-width: 85%; }
.bubble {
  background: var(--white);
  border-radius: var(--bubble-r);
  padding: 14px 15px;
  position: relative;
  overflow: hidden;
}
.bubble-content {
  font-size: 16px;
  line-height: 1.75;
  color: var(--txt);
  max-height: 470px;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}
.bubble-content::-webkit-scrollbar { display: none; }
.bubble-content p { text-indent: 2em; margin-bottom: 8px; }
.bubble-content p:last-child { margin-bottom: 0; }
.ch-title {
  font-size: 15px;
  font-weight: 600;
  text-indent: 0 !important;
  text-align: center;
  color: #333;
  padding-bottom: 12px;
  margin-bottom: 12px !important;
  border-bottom: 0.5px solid #F0F0F0;
  letter-spacing: 1px;
}
.bubble::after {
  content: '';
  position: absolute;
  bottom: 0; left: 0; right: 0;
  height: 36px;
  background: linear-gradient(transparent, rgba(255,255,255,0.92));
  pointer-events: none;
  border-radius: 0 0 18px 18px;
}

/* â”€â”€â”€ INPUT BAR â”€â”€â”€ */
.input-bar {
  height: 70px;
  background: var(--nav);
  border-top: 0.5px solid var(--border);
  display: flex;
  align-items: center;
  padding: 0 12px;
  gap: 10px;
  flex-shrink: 0;
}
.btn-plus {
  width: 36px;
  height: 36px;
  border: 1.5px solid #B5B5B5;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.15s;
  position: relative;
  background: transparent;
  flex-shrink: 0;
}
.btn-plus:active { background: rgba(255,59,48,0.1); border-color: var(--red); transform: scale(0.92); }
.input-fake {
  flex: 1;
  height: 36px;
  background: var(--white);
  border-radius: 18px;
  display: flex;
  align-items: center;
  padding: 0 14px;
  font-size: 15px;
  color: #C0C0C0;
  cursor: default;
}
.btn-emoji {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: default;
}

/* Home indicator */
.home-ind {
  height: 34px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--nav);
  flex-shrink: 0;
}
.home-bar {
  width: 134px; height: 5px;
  background: #000;
  border-radius: 3px;
  opacity: 0.15;
}

/* â”€â”€â”€ OVERLAYS â”€â”€â”€ */
/* Context Menu */
.ctx-menu {
  position: absolute;
  top: 98px;
  right: 16px;
  background: rgba(30,30,30,0.92);
  border-radius: 14px;
  width: 190px;
  z-index: 300;
  overflow: hidden;
  backdrop-filter: blur(20px);
  transform-origin: top right;
  transform: scale(0.85);
  opacity: 0;
  transition: transform 0.2s var(--ease), opacity 0.2s;
  pointer-events: none;
  box-shadow: 0 8px 40px rgba(0,0,0,0.4);
}
.ctx-menu.open {
  transform: scale(1);
  opacity: 1;
  pointer-events: all;
}
.ctx-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px 18px;
  font-size: 15px;
  color: #F0F0F0;
  cursor: pointer;
  border-bottom: 0.5px solid rgba(255,255,255,0.08);
  transition: background 0.12s;
}
.ctx-item:last-child { border-bottom: none; }
.ctx-item:active { background: rgba(255,255,255,0.1); }
.ctx-icon { font-size: 17px; width: 22px; text-align: center; }

/* â”€â”€â”€ Chapter Screen (Full screen, PRD spec) â”€â”€â”€ */
#screen-chapter {
  background: var(--white);
}
#screen-chapter .nav-bar {
  background: var(--nav);
  border-bottom: 0.5px solid var(--border);
}
.ch-list { flex: 1; overflow-y: auto; padding-bottom: 30px; }
.ch-list::-webkit-scrollbar { display: none; }
.ch-item {
  display: flex;
  align-items: center;
  min-height: 56px;
  padding: 0 20px;
  border-bottom: 0.5px solid #F5F5F5;
  cursor: pointer;
  transition: background 0.12s;
  position: relative;
}
.ch-item:active { background: #F5F5F5; }
/* Current chapter: blue dot + blue text, per PRD */
.ch-item.cur { background: rgba(26,127,212,0.04); }
.ch-item.cur::before {
  content: '';
  position: absolute;
  left: 0; top: 0; bottom: 0;
  width: 3px;
  background: var(--blue);
  border-radius: 0 2px 2px 0;
}
.ch-num { font-size: 12px; color: #C8C8C8; width: 28px; flex-shrink: 0; }
/* PRD: current=blue, read=gray, unread=black */
.ch-name { flex: 1; font-size: 16px; color: var(--txt); }
.ch-item.cur .ch-name { font-weight: 600; color: var(--blue); }
.ch-item.read .ch-name { color: #AAAAAA; }
.ch-status { font-size: 11px; margin-left: 8px; color: #CCCCCC; }
.ch-item.cur .ch-status { color: var(--blue); }
.ch-item.read .ch-status { color: #BBBBBB; }

/* Dim overlay */
.dim {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0);
  z-index: 200;
  pointer-events: none;
  transition: background 0.25s;
  border-radius: 52px;
}
.dim.show { background: rgba(0,0,0,0.4); pointer-events: all; }

/* â”€â”€â”€ BOSS KEY SCREEN â”€â”€â”€ */
#screen-boss {
  background: var(--nav);
}
.boss-topbar {
  height: 44px;
  border-bottom: 0.5px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 17px;
  font-weight: 600;
  color: var(--txt);
  background: var(--nav);
  flex-shrink: 0;
}
.chat-list-fake { flex: 1; overflow: hidden; background: var(--nav); }
.fake-item {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  background: var(--white);
  border-bottom: 0.5px solid #EBEBEB;
  gap: 12px;
  cursor: default;
}
.fake-av {
  width: 48px; height: 48px;
  border-radius: 8px;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 22px;
}
.av1 { background: linear-gradient(135deg,#84FAB0,#8FD3F4); }
.av2 { background: linear-gradient(135deg,#FDDB92,#D1FDFF); }
.av3 { background: linear-gradient(135deg,#a18cd1,#fbc2eb); }
.fake-info { flex: 1; min-width: 0; }
.fake-name { font-size: 16px; font-weight: 500; color: var(--txt); margin-bottom: 3px; }
.fake-preview { font-size: 13px; color: var(--muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.fake-meta { display: flex; flex-direction: column; align-items: flex-end; gap: 5px; }
.fake-time { font-size: 12px; color: var(--muted); }
.fake-badge {
  width: 18px; height: 18px;
  background: var(--red);
  border-radius: 50%;
  font-size: 11px;
  color: #fff;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
}
.bottom-tabs {
  height: 84px;
  border-top: 0.5px solid var(--border);
  background: var(--nav);
  display: flex;
  align-items: flex-start;
  padding-top: 8px;
  flex-shrink: 0;
}
.tab-item {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 3px;
  font-size: 10px;
  color: var(--muted);
  cursor: pointer;
}
.tab-item.on { color: var(--green); }

/* â”€â”€â”€ BOOKSHELF SCREEN â”€â”€â”€ */
#screen-shelf {
  background: #F2F2F7;
}
#screen-shelf .nav-bar { background: #F2F2F7; border-bottom: 0.5px solid var(--border); }
.shelf-area {
  flex: 1;
  overflow-y: auto;
  padding: 16px 16px 20px;
}
.shelf-area::-webkit-scrollbar { display: none; }
.shelf-section-title {
  font-size: 13px;
  font-weight: 600;
  color: #888;
  letter-spacing: 1px;
  margin-bottom: 12px;
  padding-left: 4px;
}
.book-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-bottom: 24px;
}
.book-card {
  background: var(--white);
  border-radius: 12px;
  overflow: hidden;
  cursor: pointer;
  transition: transform 0.18s, box-shadow 0.18s;
  box-shadow: 0 2px 12px rgba(0,0,0,0.06);
}
.book-card:active { transform: scale(0.96); box-shadow: 0 1px 4px rgba(0,0,0,0.08); }
.book-cover {
  height: 110px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 36px;
  position: relative;
}
.book-cover-overlay {
  position: absolute;
  inset: 0;
  background: linear-gradient(to bottom, transparent 40%, rgba(0,0,0,0.35));
}
.cover1 { background: linear-gradient(135deg, #667eea, #764ba2); }
.cover2 { background: linear-gradient(135deg, #f093fb, #f5576c); }
.cover3 { background: linear-gradient(135deg, #4facfe, #00f2fe); }
.cover4 { background: linear-gradient(135deg, #43e97b, #38f9d7); }
.book-info { padding: 10px 12px 12px; }
.book-title { font-size: 14px; font-weight: 600; color: var(--txt); margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.book-author { font-size: 11px; color: var(--muted); margin-bottom: 8px; }
.book-progress { height: 3px; background: #F0F0F0; border-radius: 2px; overflow: hidden; }
.book-progress-bar { height: 100%; background: var(--green); border-radius: 2px; transition: width 0.4s; }
.book-progress-txt { font-size: 10px; color: var(--muted); margin-top: 4px; }
.book-card.active-book { box-shadow: 0 0 0 2px var(--green), 0 4px 20px rgba(7,193,96,0.2); }

.import-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 16px;
  background: var(--white);
  border-radius: 12px;
  font-size: 15px;
  color: var(--blue);
  cursor: pointer;
  border: 1.5px dashed #C8C8C8;
  transition: all 0.15s;
}
.import-btn:active { background: #F5F5F5; }

/* â”€â”€â”€ FONT SETTING â”€â”€â”€ */
.font-sheet {
  position: absolute;
  bottom: 70px;
  left: 0; right: 0;
  background: var(--white);
  border-radius: 20px 20px 0 0;
  z-index: 260;
  transform: translateY(110%);
  transition: transform 0.28s var(--ease);
  box-shadow: 0 -4px 30px rgba(0,0,0,0.12);
  padding: 20px 24px 30px;
}
.font-sheet.open { transform: translateY(0); }
.font-sheet-title {
  font-size: 13px;
  color: var(--muted);
  text-align: center;
  margin-bottom: 20px;
  letter-spacing: 1px;
}
.font-options {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin-bottom: 20px;
}
.font-opt {
  flex: 1;
  height: 52px;
  border: 1.5px solid var(--border);
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.15s;
  color: var(--txt);
  font-weight: 500;
}
.font-opt.sel { border-color: var(--green); background: rgba(7,193,96,0.08); color: var(--green); }
.font-opt:nth-child(1) { font-size: 13px; }
.font-opt:nth-child(2) { font-size: 16px; }
.font-opt:nth-child(3) { font-size: 19px; }
.font-sheet-close {
  width: 100%;
  height: 44px;
  background: #F5F5F5;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 15px;
  color: var(--muted);
  cursor: pointer;
}

/* â”€â”€â”€ CONTACT SETTING â”€â”€â”€ */
#screen-contact {
  background: #F2F2F7;
}
.contact-form { padding: 20px 16px; }
.form-section {
  background: var(--white);
  border-radius: 12px;
  overflow: hidden;
  margin-bottom: 20px;
}
.form-row {
  display: flex;
  align-items: center;
  padding: 14px 16px;
  border-bottom: 0.5px solid #F0F0F0;
  gap: 12px;
}
.form-row:last-child { border-bottom: none; }
.form-label { font-size: 15px; color: var(--txt); width: 80px; flex-shrink: 0; }
.form-value {
  flex: 1;
  font-size: 15px;
  color: var(--muted);
  text-align: right;
  cursor: text;
}
.form-arrow { color: #C8C8C8; font-size: 13px; }
.avatar-picker {
  display: flex;
  justify-content: center;
  padding: 24px 0 16px;
}
.avatar-big {
  width: 80px;
  height: 80px;
  border-radius: 16px;
  background: linear-gradient(135deg, #F8BBD9, #CE93D8, #9FA8DA);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 40px;
  position: relative;
  cursor: pointer;
}
.avatar-edit-badge {
  position: absolute;
  bottom: -6px; right: -6px;
  width: 24px; height: 24px;
  background: var(--blue);
  border-radius: 50%;
  border: 2px solid var(--white);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  color: white;
}

/* â”€â”€â”€ TOAST â”€â”€â”€ */
.toast {
  position: absolute;
  bottom: 120px;
  left: 50%;
  transform: translateX(-50%) translateY(20px);
  background: rgba(0,0,0,0.75);
  color: white;
  font-size: 13px;
  padding: 9px 20px;
  border-radius: 20px;
  white-space: nowrap;
  opacity: 0;
  transition: all 0.25s;
  z-index: 400;
  backdrop-filter: blur(10px);
}
.toast.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

/* â”€â”€â”€ BOSS KEY flash â”€â”€â”€ */
.flash-overlay {
  position: absolute;
  inset: 0;
  background: var(--white);
  z-index: 500;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.05s;
  border-radius: 52px;
}
.flash-overlay.flash { opacity: 1; }

/* â”€â”€â”€ LONG PRESS INDICATOR â”€â”€â”€ */
.lp-ring {
  position: absolute;
  top: 170px;
  left: 12px;
  width: 40px;
  height: 40px;
  border-radius: 6px;
  z-index: 180;
  pointer-events: none;
}
.lp-ring svg {
  position: absolute;
  inset: -6px;
  width: calc(100% + 12px);
  height: calc(100% + 12px);
}
.lp-ring circle {
  fill: none;
  stroke: var(--green);
  stroke-width: 2.5;
  stroke-dasharray: 164;
  stroke-dashoffset: 164;
  stroke-linecap: round;
  transform: rotate(-90deg);
  transform-origin: 50% 50%;
  transition: stroke-dashoffset 0.5s linear;
}
.lp-ring.filling circle { stroke-dashoffset: 0; }

/* Shimmer on bubble content for scroll invite */
@keyframes scroll-bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-4px); }
}
.scroll-hint {
  text-align: center;
  font-size: 11px;
  color: #CCC;
  padding: 4px 0 2px;
  letter-spacing: 0.5px;
  animation: scroll-bounce 2s ease-in-out infinite;
  flex-shrink: 0;
}

/* â”€â”€â”€ STATIC CHAT BUBBLES â”€â”€â”€ */
.avatar-static {
  width: 40px;
  height: 40px;
  border-radius: 6px;
  flex-shrink: 0;
  background: linear-gradient(135deg, #F8BBD9, #CE93D8, #9FA8DA);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  user-select: none;
}
.bubble-recv {
  border-radius: 4px 18px 18px 18px !important;
  background: var(--white) !important;
}
.bubble-send {
  border-radius: 18px 4px 18px 18px !important;
  background: #9FE175 !important;
}
.bubble-text {
  font-size: 15px;
  line-height: 1.55;
  color: var(--txt);
}
.avatar-self {
  width: 40px;
  height: 40px;
  border-radius: 6px;
  flex-shrink: 0;
  background: linear-gradient(135deg, #A8EDCE, #74B9FF);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  user-select: none;
}
.msg-row-self {
  flex-direction: row-reverse;
  padding-left: 12px;
  padding-right: 12px;
}
.bubble-wrap-self {
  padding-left: 0;
  padding-right: 10px;
  display: flex;
  justify-content: flex-end;
}
.bubble-wrap-self .bubble {
  max-width: 75%;
}

/* Chapter panel improvements */
.ch-search {
  margin: 10px 16px 0;
  height: 34px;
  background: #F2F2F7;
  border-radius: 10px;
  display: flex;
  align-items: center;
  padding: 0 12px;
  gap: 8px;
  flex-shrink: 0;
}
.ch-search input {
  flex: 1;
  border: none;
  outline: none;
  background: transparent;
  font-size: 14px;
  color: var(--txt);
}
.ch-search input::placeholder { color: #B0B0B0; }
.ch-search-icon { color: #B0B0B0; font-size: 14px; }

.ch-summary {
  padding: 8px 20px 6px;
  font-size: 11px;
  color: #C0C0C0;
  letter-spacing: 0.3px;
  flex-shrink: 0;
  border-bottom: 0.5px solid #F2F2F2;
}

.ch-item-inner {
  flex: 1;
  min-width: 0;
}
.ch-name { font-size: 15px; color: var(--txt); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.ch-meta { font-size: 11px; color: #C8C8C8; margin-top: 2px; }
.ch-item.cur .ch-meta { color: var(--green); }
.ch-right { display: flex; flex-direction: column; align-items: flex-end; gap: 4px; margin-left: 8px; }
.ch-status-badge {
  font-size: 10px;
  padding: 2px 7px;
  border-radius: 10px;
  background: #F2F2F2;
  color: #AAAAAA;
  white-space: nowrap;
}
.ch-item.cur .ch-status-badge { background: rgba(7,193,96,0.12); color: var(--green); }
.ch-item.read .ch-status-badge { background: transparent; color: #CCCCCC; }
.ch-mini-bar {
  width: 40px; height: 3px;
  background: #F0F0F0;
  border-radius: 2px;
  overflow: hidden;
}
.ch-mini-fill { height: 100%; background: var(--green); border-radius: 2px; }
.ch-item.read .ch-mini-fill { background: #D8D8D8; }
.ch-empty {
  padding: 40px 20px;
  text-align: center;
  color: #C8C8C8;
  font-size: 14px;
}

/* SVG icons helpers */
svg { display: block; }

/* â”€â”€â”€ WELCOME / EMPTY STATE â”€â”€â”€ */
.empty-state {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 12px;
  color: var(--muted);
}
.empty-icon { font-size: 48px; opacity: 0.4; }
.empty-title { font-size: 16px; color: #AAAAAA; }
.empty-sub { font-size: 13px; color: #CCCCCC; text-align: center; line-height: 1.6; }
</style>
</head>
<body>

<div class="proto-meta">
  <h1>MoYu Reader Â· Interactive Prototype</h1>
  <span>æ‘¸é±¼é˜…è¯» Â· å®Œæ•´äº¤äº’åŸå‹ Â· PRD v1.3</span>
</div>

<!-- Flow dots -->
<div class="flow-panel">
  <div class="flow-dot active" data-screen="reading" data-label="é˜…è¯»"></div>
  <div class="flow-dot" data-screen="chapter" data-label="ç« èŠ‚ç›®å½•"></div>
  <div class="flow-dot" data-screen="boss" data-label="è€æ¿é”®"></div>
  <div class="flow-dot" data-screen="shelf" data-label="ä¹¦æ¶"></div>
  <div class="flow-dot" data-screen="contact" data-label="è”ç³»äºº"></div>
</div>

<div class="shell">
<div class="phone">
  <div class="dynamic-island"></div>

  <!-- â•â•â•â•â•â•â•â•â•â• SCREEN: READING â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen active" id="screen-reading">
    <div class="status-bar">
      <span class="s-time" id="live-time">9:41</span>
      <div class="s-icons">
        <!-- Signal -->
        <svg width="17" height="12" viewBox="0 0 17 12"><rect x="0" y="5" width="3" height="7" rx="1" fill="#1A1A1A"/><rect x="4.5" y="3" width="3" height="9" rx="1" fill="#1A1A1A"/><rect x="9" y="1" width="3" height="11" rx="1" fill="#1A1A1A"/><rect x="13.5" y="0" width="3" height="12" rx="1" fill="#1A1A1A" opacity="0.3"/></svg>
        <!-- Wifi -->
        <svg width="16" height="12" viewBox="0 0 16 12"><path d="M8 9.5C8.8 9.5 9.5 10.2 9.5 11S8.8 12.5 8 12.5 6.5 11.8 6.5 11 7.2 9.5 8 9.5Z" fill="#1A1A1A"/><path d="M3.8 7.3C4.9 6.2 6.4 5.5 8 5.5S11.1 6.2 12.2 7.3" stroke="#1A1A1A" stroke-width="1.4" fill="none" stroke-linecap="round"/><path d="M1.2 4.7C2.9 3 5.3 2 8 2s5.1 1 6.8 2.7" stroke="#1A1A1A" stroke-width="1.4" fill="none" stroke-linecap="round"/></svg>
        <!-- Battery -->
        <svg width="26" height="13" viewBox="0 0 26 13"><rect x="0" y="1.5" width="23" height="10" rx="3" stroke="#1A1A1A" stroke-width="1.2" fill="none"/><rect x="1.5" y="3" width="17" height="7" rx="1.5" fill="#1A1A1A"/><path d="M24 5V8C24.8 7.7 25.5 7 25.5 6.5S24.8 5.3 24 5Z" fill="#1A1A1A"/></svg>
      </div>
    </div>
    <div class="nav-bar">
      <div class="nav-back">
        <svg width="10" height="17" viewBox="0 0 10 17" fill="none"><path d="M9 1L1 8.5L9 16" stroke="#1A7FD4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </div>
      <div class="nav-center">
        <span class="nav-name" id="contact-name-display">å°ç¾ğŸŒ¸</span>
        <span class="nav-sub">åœ¨çº¿</span>
      </div>
      <div class="nav-more" id="btn-menu">
        <svg width="22" height="6" viewBox="0 0 22 6"><circle cx="3" cy="3" r="2.4" fill="#1A1A1A"/><circle cx="11" cy="3" r="2.4" fill="#1A1A1A"/><circle cx="19" cy="3" r="2.4" fill="#1A1A1A"/></svg>
      </div>
    </div>

    <!-- Context Menu -->
    <div class="ctx-menu" id="ctx-menu">
      <div class="ctx-item" id="menu-shelf">
        <span class="ctx-icon">ğŸ“š</span> æˆ‘çš„ä¹¦æ¶
      </div>
      <div class="ctx-item" id="menu-import">
        <span class="ctx-icon">ğŸ“„</span> å¯¼å…¥æ–°ä¹¦
      </div>
      <div class="ctx-item" id="menu-font">
        <span class="ctx-icon">æ–‡</span> è°ƒæ•´å­—ä½“
      </div>
      <div class="ctx-item" id="menu-contact">
        <span class="ctx-icon">ğŸ‘¤</span> è”ç³»äººè®¾ç½®
      </div>
      <div class="ctx-item" id="menu-selfavatar">
        <span class="ctx-icon">ğŸ™‚</span> è‡ªå·±å¤´åƒè®¾ç½®
      </div>
      <div class="ctx-item" id="menu-chatcustom">
        <span class="ctx-icon">ğŸ’¬</span> èŠå¤©å†…å®¹è‡ªå®šä¹‰
      </div>
      <div class="ctx-item" id="menu-mode">
        <span class="ctx-icon">ğŸ§­</span> åˆ‡æ¢æ¨¡å¼
      </div>
      <div class="ctx-item" style="opacity:0.35; pointer-events:none;">
        <span class="ctx-icon">ğŸ¨</span> åˆ‡æ¢çš®è‚¤ï¼ˆæ•¬è¯·æœŸå¾…ï¼‰
      </div>
    </div>

    <!-- Dim overlay for menus -->
    <div class="dim" id="dim-reading"></div>

    <!-- Chapter panel removed: now a full-screen sibling screen -->

    <!-- Font Sheet -->
    <div class="font-sheet" id="font-sheet">
      <div class="font-sheet-title">å­—ä½“å¤§å°</div>
      <div class="font-options">
        <div class="font-opt" data-size="14">å°</div>
        <div class="font-opt sel" data-size="16">ä¸­</div>
        <div class="font-opt" data-size="18">å¤§</div>
      </div>
      <div class="font-sheet-close" id="font-sheet-close">å®Œæˆ</div>
    </div>

    <!-- Long-press ring -->
    <div class="lp-ring" id="lp-ring">
      <svg viewBox="0 0 52 52">
        <circle cx="26" cy="26" r="24"/>
      </svg>
    </div>

    <div class="chat-area" id="chat-area">

      <!-- â”€â”€ æ—©æ™¨é™æ€èŠå¤©è®°å½• â”€â”€ -->
      <div class="timestamp">ä¸Šåˆ 8:12</div>

      <div class="msg-row">
        <div class="avatar-static" id="avatar-static-1">ğŸŒ¸</div>
        <div class="bubble-wrap">
          <div class="bubble bubble-recv"><div class="bubble-text">æ—©å®‰ï¼ä»Šå¤©å¤©æ°”å¥½å¥½å•Š â˜€ï¸</div></div>
        </div>
      </div>

      <div class="msg-row msg-row-self">
        <div class="avatar-self" id="self-avatar-1">ğŸ˜Š</div>
        <div class="bubble-wrap bubble-wrap-self">
          <div class="bubble bubble-send"><div class="bubble-text">å—¯å—¯ å‡ºå»ç©å•Š</div></div>
        </div>
      </div>

      <div class="msg-row">
        <div class="avatar-static">ğŸŒ¸</div>
        <div class="bubble-wrap">
          <div class="bubble bubble-recv"><div class="bubble-text">å¯¹å‘€ï¼ä½ æœ€è¿‘åœ¨çœ‹ä»€ä¹ˆä¹¦å•Šï¼Œæ„Ÿè§‰ä½ æ¯æ¬¡éƒ½åœ¨åˆ·æ‰‹æœºå“ˆå“ˆ</div></div>
        </div>
      </div>

      <div class="msg-row msg-row-self">
        <div class="avatar-self">ğŸ˜Š</div>
        <div class="bubble-wrap bubble-wrap-self">
          <div class="bubble bubble-send"><div class="bubble-text">æ²¡æœ‰å•¦ï¼Œå°±æ˜¯æ™®é€šåˆ·å¾®ä¿¡ğŸ˜…</div></div>
        </div>
      </div>

      <div class="msg-row">
        <div class="avatar-static">ğŸŒ¸</div>
        <div class="bubble-wrap">
          <div class="bubble bubble-recv"><div class="bubble-text">å¥½å§å¥½å§ï¼Œä½ è·Ÿæˆ‘è¯´ä½ ç°åœ¨çœ‹åˆ°å“ªé‡Œäº†ï¼</div></div>
        </div>
      </div>

      <div class="msg-row msg-row-self">
        <div class="avatar-self">ğŸ˜Š</div>
        <div class="bubble-wrap bubble-wrap-self">
          <div class="bubble bubble-send"><div class="bubble-text">â€¦â€¦ä»€ä¹ˆçœ‹åˆ°å“ªé‡Œäº†</div></div>
        </div>
      </div>

      <div class="timestamp">ä¸Šåˆ 8:35</div>

      <div class="msg-row">
        <div class="avatar-static">ğŸŒ¸</div>
        <div class="bubble-wrap">
          <div class="bubble bubble-recv"><div class="bubble-text">ã€Šå‘½è¿ä¹‹è½®ã€‹ï¼æˆ‘ä¹Ÿåœ¨çœ‹è¿™æœ¬ï¼Œæ˜¨å¤©çœ‹åˆ°ç¬¬åå…­ç« å“­æ­»æˆ‘äº† ğŸ˜­</div></div>
        </div>
      </div>

      <div class="msg-row msg-row-self">
        <div class="avatar-self">ğŸ˜Š</div>
        <div class="bubble-wrap bubble-wrap-self">
          <div class="bubble bubble-send"><div class="bubble-text">æˆ‘æ‰åˆ°åä¸ƒç« â€¦â€¦åˆ«å‰§é€</div></div>
        </div>
      </div>

      <div class="msg-row">
        <div class="avatar-static">ğŸŒ¸</div>
        <div class="bubble-wrap">
          <div class="bubble bubble-recv"><div class="bubble-text">å¥½å¥½å¥½ä¸è¯´ï¼ç»§ç»­çœ‹å§ï¼Œé™†æ²‰è¿™ä¸€ç« å¤ªç»äº† ğŸ‘‡</div></div>
        </div>
      </div>

      <div class="timestamp">ä¸Šåˆ 9:41</div>

      <!-- â”€â”€ æ­£æ–‡é˜…è¯»å¤§æ°”æ³¡ â”€â”€ -->
      <div class="msg-row" id="reading-row">
        <div class="avatar" id="avatar" title="é•¿æŒ‰è¿›å…¥ç« èŠ‚ç›®å½•">ğŸŒ¸</div>
        <div class="bubble-wrap">
          <div class="bubble">
            <div class="bubble-content" id="bubble-content"></div>
          </div>
        </div>
      </div>

    </div>

    <div class="input-bar">
      <div class="btn-plus" id="btn-boss" title="è€æ¿é”®ï¼šç«‹åˆ»éšè—">
        <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M7 1V13M1 7H13" stroke="#888" stroke-width="1.8" stroke-linecap="round"/></svg>
      </div>
      <div class="input-fake">å‘é€æ¶ˆæ¯</div>
      <div class="btn-emoji">
        <svg width="22" height="22" viewBox="0 0 22 22" fill="none"><circle cx="11" cy="11" r="9.5" stroke="#888" stroke-width="1.5"/><circle cx="8" cy="9" r="1.2" fill="#888"/><circle cx="14" cy="9" r="1.2" fill="#888"/><path d="M7 13.5C7.8 15 9.3 16 11 16C12.7 16 14.2 15 15 13.5" stroke="#888" stroke-width="1.5" stroke-linecap="round"/></svg>
      </div>
    </div>
    <div class="home-ind"><div class="home-bar"></div></div>

    <!-- Flash & Toast -->
    <div class="flash-overlay" id="flash"></div>
    <div class="toast" id="toast-reading"></div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â• SCREEN: BOSS KEY â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen" id="screen-boss">
    <div class="status-bar">
      <span class="s-time" id="live-time-boss">9:41</span>
      <div class="s-icons">
        <svg width="17" height="12" viewBox="0 0 17 12"><rect x="0" y="5" width="3" height="7" rx="1" fill="#1A1A1A"/><rect x="4.5" y="3" width="3" height="9" rx="1" fill="#1A1A1A"/><rect x="9" y="1" width="3" height="11" rx="1" fill="#1A1A1A"/><rect x="13.5" y="0" width="3" height="12" rx="1" fill="#1A1A1A" opacity="0.3"/></svg>
        <svg width="16" height="12" viewBox="0 0 16 12"><path d="M8 9.5C8.8 9.5 9.5 10.2 9.5 11S8.8 12.5 8 12.5 6.5 11.8 6.5 11 7.2 9.5 8 9.5Z" fill="#1A1A1A"/><path d="M3.8 7.3C4.9 6.2 6.4 5.5 8 5.5S11.1 6.2 12.2 7.3" stroke="#1A1A1A" stroke-width="1.4" fill="none" stroke-linecap="round"/><path d="M1.2 4.7C2.9 3 5.3 2 8 2s5.1 1 6.8 2.7" stroke="#1A1A1A" stroke-width="1.4" fill="none" stroke-linecap="round"/></svg>
        <svg width="26" height="13" viewBox="0 0 26 13"><rect x="0" y="1.5" width="23" height="10" rx="3" stroke="#1A1A1A" stroke-width="1.2" fill="none"/><rect x="1.5" y="3" width="17" height="7" rx="1.5" fill="#1A1A1A"/><path d="M24 5V8C24.8 7.7 25.5 7 25.5 6.5S24.8 5.3 24 5Z" fill="#1A1A1A"/></svg>
      </div>
    </div>
    <div class="boss-topbar">å¾®ä¿¡</div>
    <div class="chat-list-fake">
      <div class="fake-item">
        <div class="fake-av av1">ğŸ‘©</div>
        <div class="fake-info">
          <div class="fake-name">å¦ˆå¦ˆ</div>
          <div class="fake-preview">[è¯­éŸ³] 12"</div>
        </div>
        <div class="fake-meta">
          <span class="fake-time">9:20</span>
          <div class="fake-badge">2</div>
        </div>
      </div>
      <div class="fake-item">
        <div class="fake-av av2">ğŸ¢</div>
        <div class="fake-info">
          <div class="fake-name">é¡¹ç›®ç»„</div>
          <div class="fake-preview">å°ç‹ï¼šä»Šå¤©ä¼šè®®æ¨è¿Ÿåˆ°3ç‚¹</div>
        </div>
        <div class="fake-meta">
          <span class="fake-time">9:15</span>
        </div>
      </div>
      <div class="fake-item">
        <div class="fake-av av3">ğŸ“</div>
        <div class="fake-info">
          <div class="fake-name">å¤§å­¦åŒå­¦ç¾¤</div>
          <div class="fake-preview">ææµ©ï¼šå‘¨æœ«èšä¼šè®°å¾—æ¥</div>
        </div>
        <div class="fake-meta">
          <span class="fake-time">æ˜¨å¤©</span>
        </div>
      </div>
    </div>
    <div class="bottom-tabs">
      <div class="tab-item on">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M4 12.5C4 8.1 7.6 4.5 12 4.5C16.4 4.5 20 8.1 20 12.5C20 16.9 16.4 20.5 12 20.5" stroke="#07C160" stroke-width="1.5"/><circle cx="12" cy="12.5" r="2.5" fill="#07C160"/></svg>
        <span>å¾®ä¿¡</span>
      </div>
      <div class="tab-item">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="8" r="4" stroke="#888" stroke-width="1.5"/><path d="M4 20C4 17 7.6 14.5 12 14.5C16.4 14.5 20 17 20 20" stroke="#888" stroke-width="1.5" stroke-linecap="round"/></svg>
        <span>é€šè®¯å½•</span>
      </div>
      <div class="tab-item">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="8.5" stroke="#888" stroke-width="1.5"/><circle cx="12" cy="12" r="2.5" fill="#888"/></svg>
        <span>å‘ç°</span>
      </div>
      <div class="tab-item">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="8" r="3.5" stroke="#888" stroke-width="1.5"/><rect x="5" y="14" width="14" height="7" rx="2" stroke="#888" stroke-width="1.5"/></svg>
        <span>æˆ‘</span>
      </div>
    </div>
    <div class="home-ind"><div class="home-bar"></div></div>
    <div class="toast" id="toast-boss">ç‚¹å‡»ä»»æ„å¤„è¿”å›é˜…è¯»</div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â• SCREEN: BOOKSHELF â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen" id="screen-shelf" style="background:#F2F2F7">
    <div class="status-bar" style="background:#F2F2F7">
      <span class="s-time">9:41</span>
      <div class="s-icons">
        <svg width="17" height="12" viewBox="0 0 17 12"><rect x="0" y="5" width="3" height="7" rx="1" fill="#1A1A1A"/><rect x="4.5" y="3" width="3" height="9" rx="1" fill="#1A1A1A"/><rect x="9" y="1" width="3" height="11" rx="1" fill="#1A1A1A"/></svg>
        <svg width="26" height="13" viewBox="0 0 26 13"><rect x="0" y="1.5" width="23" height="10" rx="3" stroke="#1A1A1A" stroke-width="1.2" fill="none"/><rect x="1.5" y="3" width="17" height="7" rx="1.5" fill="#1A1A1A"/><path d="M24 5V8C24.8 7.7 25.5 7 25.5 6.5S24.8 5.3 24 5Z" fill="#1A1A1A"/></svg>
      </div>
    </div>
    <div class="nav-bar" style="background:#F2F2F7">
      <div class="nav-back" id="shelf-back">
        <svg width="10" height="17" viewBox="0 0 10 17" fill="none"><path d="M9 1L1 8.5L9 16" stroke="#1A7FD4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        &nbsp;è¿”å›
      </div>
      <div class="nav-center"><span class="nav-name">æˆ‘çš„ä¹¦æ¶</span></div>
    </div>
    <div class="shelf-area">
      <div class="shelf-section-title">æ­£åœ¨é˜…è¯»</div>
      <div class="book-grid">
        <div class="book-card active-book" data-book="0" id="book-0">
          <div class="book-cover cover1">
            ğŸ“–
            <div class="book-cover-overlay"></div>
          </div>
          <div class="book-info">
            <div class="book-title">å‘½è¿ä¹‹è½®</div>
            <div class="book-author">æ—é›¨æ¸… è‘—</div>
            <div class="book-progress"><div class="book-progress-bar" style="width:42%"></div></div>
            <div class="book-progress-txt">ç¬¬17ç«  Â· 42%</div>
          </div>
        </div>
        <div class="book-card" data-book="1" id="book-1">
          <div class="book-cover cover2">
            ğŸŒ™
            <div class="book-cover-overlay"></div>
          </div>
          <div class="book-info">
            <div class="book-title">æ·±å¤œä¹¦åº—</div>
            <div class="book-author">è‹æ™šæ™´ è‘—</div>
            <div class="book-progress"><div class="book-progress-bar" style="width:8%"></div></div>
            <div class="book-progress-txt">ç¬¬2ç«  Â· 8%</div>
          </div>
        </div>
      </div>
      <div class="shelf-section-title">ä¹¦æ¶</div>
      <div class="book-grid">
        <div class="book-card" data-book="2">
          <div class="book-cover cover3">
            ğŸŒŠ
            <div class="book-cover-overlay"></div>
          </div>
          <div class="book-info">
            <div class="book-title">æ˜Ÿæ²³æ¼«æ¸¸</div>
            <div class="book-author">é¡¾åŒ—è¾° è‘—</div>
            <div class="book-progress"><div class="book-progress-bar" style="width:0%"></div></div>
            <div class="book-progress-txt">æœªå¼€å§‹</div>
          </div>
        </div>
        <div class="book-card" data-book="3">
          <div class="book-cover cover4">
            ğŸŒ¿
            <div class="book-cover-overlay"></div>
          </div>
          <div class="book-info">
            <div class="book-title">ç§‹æ—¥ç‰©è¯­</div>
            <div class="book-author">ç™½é¹¤é¸£ è‘—</div>
            <div class="book-progress"><div class="book-progress-bar" style="width:100%"></div></div>
            <div class="book-progress-txt">å·²è¯»å®Œ âœ“</div>
          </div>
        </div>
      </div>
      <div class="import-btn" id="shelf-import">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M10 3V13M10 13L6 9M10 13L14 9" stroke="#1A7FD4" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M3 16H17" stroke="#1A7FD4" stroke-width="1.5" stroke-linecap="round"/></svg>
        å¯¼å…¥æ–°ä¹¦ (TXT)
      </div>
    </div>
    <div class="home-ind"><div class="home-bar"></div></div>
    <div class="toast" id="toast-shelf"></div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â• SCREEN: CONTACT SETTING â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen" id="screen-contact" style="background:#F2F2F7">
    <div class="status-bar" style="background:#F2F2F7">
      <span class="s-time">9:41</span>
      <div class="s-icons">
        <svg width="17" height="12" viewBox="0 0 17 12"><rect x="0" y="5" width="3" height="7" rx="1" fill="#1A1A1A"/><rect x="4.5" y="3" width="3" height="9" rx="1" fill="#1A1A1A"/><rect x="9" y="1" width="3" height="11" rx="1" fill="#1A1A1A"/></svg>
        <svg width="26" height="13" viewBox="0 0 26 13"><rect x="0" y="1.5" width="23" height="10" rx="3" stroke="#1A1A1A" stroke-width="1.2" fill="none"/><rect x="1.5" y="3" width="17" height="7" rx="1.5" fill="#1A1A1A"/><path d="M24 5V8C24.8 7.7 25.5 7 25.5 6.5S24.8 5.3 24 5Z" fill="#1A1A1A"/></svg>
      </div>
    </div>
    <div class="nav-bar" style="background:#F2F2F7">
      <div class="nav-back" id="contact-back">
        <svg width="10" height="17" viewBox="0 0 10 17" fill="none"><path d="M9 1L1 8.5L9 16" stroke="#1A7FD4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        &nbsp;è¿”å›
      </div>
      <div class="nav-center"><span class="nav-name">è”ç³»äººè®¾ç½®</span></div>
      <div class="nav-more" style="color:var(--blue);font-size:15px;" id="contact-save">ä¿å­˜</div>
    </div>
    <div class="contact-form">
      <div class="avatar-picker">
        <div class="avatar-big" id="avatar-picker">
          <span id="avatar-emoji">ğŸŒ¸</span>
          <div class="avatar-edit-badge">âœ</div>
        </div>
      </div>
      <div class="form-section">
        <div class="form-row">
          <span class="form-label">æ˜µç§°</span>
          <input
            id="contact-name-input"
            style="border:none;outline:none;background:transparent;flex:1;font-size:15px;color:#1A1A1A;text-align:right;"
            value="å°ç¾ğŸŒ¸"
            maxlength="12"
          />
        </div>
        <div class="form-row">
          <span class="form-label">å¤´åƒè¡¨æƒ…</span>
          <span class="form-value" id="emoji-select-hint">ç‚¹å‡»å¤´åƒæ›´æ¢</span>
        </div>
      </div>
      <div class="form-section">
        <div class="form-row">
          <span class="form-label">åœ¨çº¿çŠ¶æ€</span>
          <span class="form-value">åœ¨çº¿</span>
          <span class="form-arrow">â€º</span>
        </div>
        <div class="form-row">
          <span class="form-label">æ¶ˆæ¯æ—¶é—´</span>
          <span class="form-value">æ˜¾ç¤ºå®æ—¶æ—¶é—´</span>
          <span class="form-arrow">â€º</span>
        </div>
      </div>
    </div>
    <!-- emoji picker -->
    <div id="emoji-picker" style="display:none;position:absolute;bottom:100px;left:50%;transform:translateX(-50%);background:white;border-radius:16px;padding:16px;box-shadow:0 8px 40px rgba(0,0,0,0.2);z-index:300;width:320px;">
      <div style="font-size:12px;color:#888;margin-bottom:12px;text-align:center;letter-spacing:1px;">é€‰æ‹©å¤´åƒ</div>
      <div id="emoji-grid" style="display:grid;grid-template-columns:repeat(6,1fr);gap:8px;"></div>
    </div>
    <div class="home-ind"><div class="home-bar"></div></div>
    <div class="toast" id="toast-contact"></div>
  </div>


  <!-- â•â•â•â•â•â•â•â•â•â• SCREEN: CHAPTER DIRECTORY (full screen, PRD Â§2.3) â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen" id="screen-chapter" style="background:#fff;">
    <div class="status-bar" style="background:var(--nav);">
      <span class="s-time">9:41</span>
      <div class="s-icons">
        <svg width="17" height="12" viewBox="0 0 17 12"><rect x="0" y="5" width="3" height="7" rx="1" fill="#1A1A1A"/><rect x="4.5" y="3" width="3" height="9" rx="1" fill="#1A1A1A"/><rect x="9" y="1" width="3" height="11" rx="1" fill="#1A1A1A"/></svg>
        <svg width="26" height="13" viewBox="0 0 26 13"><rect x="0" y="1.5" width="23" height="10" rx="3" stroke="#1A1A1A" stroke-width="1.2" fill="none"/><rect x="1.5" y="3" width="17" height="7" rx="1.5" fill="#1A1A1A"/><path d="M24 5V8C24.8 7.7 25.5 7 25.5 6.5S24.8 5.3 24 5Z" fill="#1A1A1A"/></svg>
      </div>
    </div>
    <div class="nav-bar">
      <div class="nav-back" id="chapter-back">
        <svg width="10" height="17" viewBox="0 0 10 17" fill="none"><path d="M9 1L1 8.5L9 16" stroke="#1A7FD4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        &nbsp;è¿”å›
      </div>
      <div class="nav-center"><span class="nav-name">ç›®å½•</span></div>
    </div>
    <!-- Search bar -->
    <div class="ch-search" style="margin:10px 16px 0; height:34px; background:#F2F2F7; border-radius:10px; display:flex; align-items:center; padding:0 12px; gap:8px; flex-shrink:0;">
      <span style="color:#B0B0B0;font-size:14px;">ğŸ”</span>
      <input id="ch-search-input" type="text" placeholder="æœç´¢ç« èŠ‚â€¦" style="flex:1;border:none;outline:none;background:transparent;font-size:14px;color:#1A1A1A;" />
    </div>
    <!-- Summary -->
    <div id="ch-summary" style="padding:8px 20px 6px;font-size:11px;color:#C0C0C0;letter-spacing:0.3px;flex-shrink:0;border-bottom:0.5px solid #F2F2F2;"></div>
    <!-- List -->
    <div class="ch-list" id="ch-list"></div>
    <div class="home-ind"><div class="home-bar"></div></div>
  </div>

</div><!-- /phone -->
</div><!-- /shell -->

<script>
// â”€â”€â”€ Data â”€â”€â”€
const EMOJIS = ['ğŸŒ¸','ğŸŒº','ğŸŒ¹','ğŸŒ·','ğŸŒ»','ğŸŒ¼','ğŸ¦‹','ğŸ±','ğŸ¶','ğŸ¼','ğŸ¦Š','ğŸ¨','ğŸ¯','ğŸ¦','ğŸ®','ğŸ¸','ğŸ™','ğŸ¦„','ğŸŒˆ','â­','ğŸ€','ğŸ’'];

const CHAPTERS = [
  {title:'ç¬¬ä¸€ç« ã€€ç›¸é‡',status:'read'},
  {title:'ç¬¬äºŒç« ã€€è¯¯è§£',status:'read'},
  {title:'ç¬¬ä¸‰ç« ã€€å¿ƒåŠ¨',status:'read'},
  {title:'ç¬¬å››ç« ã€€ç§˜å¯†',status:'read'},
  {title:'ç¬¬äº”ç« ã€€è·ç¦»',status:'read'},
  {title:'ç¬¬å…­ç« ã€€é£æ³¢',status:'read'},
  {title:'ç¬¬ä¸ƒç« ã€€è¯¯ä¼š',status:'read'},
  {title:'ç¬¬å…«ç« ã€€é è¿‘',status:'read'},
  {title:'ç¬¬ä¹ç« ã€€è¡¨ç™½',status:'read'},
  {title:'ç¬¬åç« ã€€å¼€å§‹',status:'read'},
  {title:'ç¬¬åä¸€ç« ã€€ç£¨åˆ',status:'read'},
  {title:'ç¬¬åäºŒç« ã€€äº‰åµ',status:'read'},
  {title:'ç¬¬åä¸‰ç« ã€€å’Œå¥½',status:'read'},
  {title:'ç¬¬åå››ç« ã€€å˜æ•…',status:'read'},
  {title:'ç¬¬åäº”ç« ã€€é€‰æ‹©',status:'read'},
  {title:'ç¬¬åå…­ç« ã€€å‘Šåˆ«',status:'read'},
  {title:'ç¬¬åä¸ƒç« ã€€å‘½è¿ä¹‹è½®',status:'current'},
  {title:'ç¬¬åå…«ç« ã€€å½’é€”',status:'unread'},
  {title:'ç¬¬åä¹ç« ã€€é‡é€¢',status:'unread'},
  {title:'ç¬¬äºŒåç« ã€€ç»ˆç« ',status:'unread'},
];

const NOVEL_TEXT = `<p class="ch-title">ç¬¬åä¸ƒç« ã€€å‘½è¿ä¹‹è½®</p>
<p>å¤œé£å·ç€è½å¶ï¼Œä»åŸå¸‚çš„é«˜å¤„å¹æ¥ï¼Œå¸¦ç€ä¸€ä¸è‹¥æœ‰è‹¥æ— çš„å‡‰æ„ã€‚é™†æ²‰ç«™åœ¨å¤©å°è¾¹ç¼˜ï¼Œæœ›ç€è„šä¸‹ç¯ç«é€šæ˜çš„éƒ½å¸‚ï¼Œå¿ƒä¸­æ¶Œèµ·ä¸€è‚¡éš¾ä»¥è¨€è¯´çš„æƒ…ç»ªã€‚</p>
<p>ä¸‰å¹´äº†ã€‚æ•´æ•´ä¸‰å¹´ï¼Œä»–æŠŠæ‰€æœ‰çš„æ—¶é—´éƒ½æŠ¼æ³¨åœ¨è¿™å®¶å…¬å¸ä¸Šï¼ŒæŠŠæ‰€æœ‰çš„çƒ­è¡€éƒ½ç‡ƒçƒ§åœ¨é‚£äº›æ— ä¼‘æ­¢çš„åŠ ç­å¤œé‡Œã€‚å¯ç°åœ¨ï¼Œä¸€åˆ‡éƒ½åœ¨é¡·åˆ»é—´åå¡Œã€‚</p>
<p>æ‰‹æœºéœ‡äº†ä¸€ä¸‹ã€‚ä»–ä½å¤´çœ‹ï¼Œæ˜¯æ—é›¨æŸ”å‘æ¥çš„æ¶ˆæ¯ï¼šã€Œä½ ç°åœ¨åœ¨å“ªå„¿ï¼Ÿæˆ‘ä¹°äº†ä½ æœ€å–œæ¬¢çš„ç³–è‘«èŠ¦ã€‚ã€</p>
<p>ä»–ç›¯ç€é‚£å¥è¯çœ‹äº†å¾ˆä¹…ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œçœ¼çœ¶å¼€å§‹é…¸æ¶©ã€‚è¿™ä¸ªå‚»å§‘å¨˜ï¼Œæ°¸è¿œåœ¨æœ€æ°å½“çš„æ—¶å€™å‡ºç°åœ¨æœ€ä¸æ°å½“çš„åœ°æ–¹ã€‚</p>
<p>ã€Œå±‹é¡¶ã€‚ã€ä»–å›äº†ä¸¤ä¸ªå­—ã€‚</p>
<p>ã€Œç­‰æˆ‘ã€‚ã€</p>
<p>ä¸ƒåˆ†é’Ÿåï¼Œæ¥¼æ¢¯é—´çš„é“é—¨å‘å‡ºå±å‘€ä¸€å£°å“ã€‚æ—é›¨æŸ”ç©¿ç€å¥¹é‚£ä»¶æ´—å¾—æœ‰äº›å‘ç™½çš„æ ¼å­å¤–å¥—ï¼Œæ‰‹é‡Œä¸¾ç€ä¸¤æ ¹ç³–è‘«èŠ¦ï¼Œå‘¼å‡ºçš„ç™½é›¾åœ¨å¤œè‰²é‡Œæ•£å¼€ï¼Œåƒæ˜¯ç«¥è¯é‡Œæ‰æœ‰çš„åœºæ™¯ã€‚</p>
<p>ã€Œä½ æ€ä¹ˆçŸ¥é“æˆ‘åœ¨è¿™å„¿ï¼Ÿã€</p>
<p>ã€ŒçŒœçš„ã€‚ã€å¥¹èµ°è¿‡æ¥ï¼ŒæŠŠå…¶ä¸­ä¸€æ ¹é€’ç»™ä»–ï¼Œã€Œæ¯æ¬¡ä½ éš¾è¿‡çš„æ—¶å€™éƒ½æ¥è¿™å„¿å¹é£ï¼Œä»¥ä¸ºæˆ‘ä¸çŸ¥é“å—ï¼Ÿã€</p>
<p>é™†æ²‰çœ‹ç€é‚£é¢—çº¢å½¤å½¤çš„å±±æ¥‚ï¼Œçªç„¶è§‰å¾—èƒ¸è…”é‡Œæœ‰ä»€ä¹ˆä¸œè¥¿æ¾åŠ¨äº†ã€‚ä»–æ²¡æœ‰æ¥ï¼Œè€Œæ˜¯è½¬è¿‡èº«ï¼ŒèƒŒé ç€æ æ†ï¼Œçœ‹å‘å¤©é™…é‚£é“ç¨€è–„çš„äº‘ã€‚</p>
<p>ã€Œé¡¹ç›®é»„äº†ã€‚ã€ä»–è¯´ï¼Œå£°éŸ³å¹³é™å¾—åƒåœ¨æ’­æŠ¥å¤©æ°”ï¼Œã€ŒæŠ•èµ„äººæ’¤äº†ï¼Œå›¢é˜Ÿæ•£äº†ï¼Œä»€ä¹ˆéƒ½æ²¡äº†ã€‚ã€</p>
<p>æ—é›¨æŸ”æ²¡æœ‰è¯´å¯¹ä¸èµ·ï¼Œä¹Ÿæ²¡æœ‰è¯´æ²¡å…³ç³»ï¼Œåªæ˜¯åœ¨ä»–æ—è¾¹åä¸‹æ¥ï¼ŒæŠŠå¦ä¸€æ ¹ç³–è‘«èŠ¦å’¬äº†ä¸€å£ï¼Œæ…¢æ…¢åš¼ç€ã€‚</p>
<p>ã€Œé‚£ä½ ä¸‹ä¸€æ­¥æƒ³æ€ä¹ˆåŠï¼Ÿã€å¥¹é—®ã€‚</p>
<p>è¿™ä¸ªé—®é¢˜é—®å¾—é™†æ²‰æ„£äº†ä¸€ä¸‹ã€‚æ‰€æœ‰äººå¬åˆ°è¿™ä¸ªæ¶ˆæ¯ï¼Œç¬¬ä¸€ååº”éƒ½æ˜¯å®‰æ…°ï¼Œéƒ½æ˜¯æƒ‹æƒœï¼Œéƒ½æ˜¯ã€Œä½ å·²ç»å¾ˆåŠªåŠ›äº†ã€ã€ã€Œä¸€å®šæœ‰åŸå› çš„ã€â€”â€”åªæœ‰å¥¹ï¼Œç›´æ¥é—®ä»–æ¥ä¸‹æ¥è¦æ€ä¹ˆåŠã€‚</p>
<p>ã€Œä¸çŸ¥é“ã€‚ã€ä»–è¯šå®åœ°è¯´ã€‚</p>
<p>ã€Œé‚£å°±å…ˆæŠŠç³–è‘«èŠ¦åƒäº†ã€‚ã€æ—é›¨æŸ”æŠŠé‚£æ ¹é€’ç»™ä»–ï¼Œã€Œåƒå®Œäº†å†æƒ³ã€‚ã€</p>
<p>é™†æ²‰ç»ˆäºç¬‘äº†ï¼Œç¬‘å¾—æœ‰äº›è‹¦ï¼Œå´ä¹Ÿæœ‰äº›çœŸå®ã€‚ä»–æ¥è¿‡ç³–è‘«èŠ¦ï¼Œè½»è½»å’¬äº†ä¸€å£ï¼Œé‚£è‚¡é…¸ç”œçš„æ»‹å‘³åœ¨èˆŒå°–æ•£å¼€ï¼Œåƒæäº†è¿™ä¸‰å¹´çš„èµ·èµ·è½è½ã€‚</p>
<p>ã€Œä½ çœŸå‚»ã€‚ã€ä»–è¯´ã€‚</p>
<p>ã€Œæˆ‘çŸ¥é“ã€‚ã€å¥¹è½»å£°åº”é“ï¼Œã€Œä½†å‚»äººæœ‰å‚»ç¦å˜›ã€‚ã€</p>
<p>ä¸¤ä¸ªäººå°±è¿™æ ·ååœ¨å¤©å°ä¸Šï¼Œçœ‹ç€åŸå¸‚çš„ç¯ç«ä¸€ç›ä¸€ç›åœ°äº®èµ·æ¥ï¼Œè°ä¹Ÿæ²¡æœ‰å†è¯´è¯ã€‚å¤œé£ä¾æ—§åœ¨å¹ï¼Œä½†ä¸çŸ¥ä»ä»€ä¹ˆæ—¶å€™èµ·ï¼Œå·²ç»ä¸å†é‚£ä¹ˆå†·äº†ã€‚</p>`;

const CH17_TEXT = NOVEL_TEXT;
const CH18_TEXT = `<p class="ch-title">ç¬¬åå…«ç« ã€€å½’é€”</p>
<p>ç¬¬äºŒå¤©æ¸…æ™¨ï¼Œé™†æ²‰é†’æ¥æ—¶ï¼Œçª—å¤–å·²ç»é€è¿›æ¥ä¸€ç¼•æ·¡æ·¡çš„é˜³å…‰ã€‚ä»–é™é™åœ°èººç€ï¼Œå¬ç€åŸå¸‚ä»ç¡æ¢¦ä¸­è‹é†’çš„å£°éŸ³ï¼Œå¿ƒé‡Œé‚£å—å‹ç€çš„çŸ³å¤´ï¼Œä¼¼ä¹è½»äº†ä¸€äº›ã€‚</p>
<p>æ‰‹æœºä¸Šæœ‰ä¸€æ¡æœªè¯»æ¶ˆæ¯ï¼Œæ˜¯æ—é›¨æŸ”æ˜¨æ™šå‘æ¥çš„ï¼šã€Œåˆ°å®¶å•¦ã€‚ç³–è‘«èŠ¦å¥½åƒå—ï¼Ÿã€åé¢è·Ÿç€ä¸€ä¸ªå‚»ä¹ä¹çš„ç¬‘è„¸è¡¨æƒ…ã€‚</p>
<p>ä»–ç›¯ç€è¿™æ¡æ¶ˆæ¯çœ‹äº†å¥½ä¹…ï¼Œç„¶åæ…¢æ…¢åœ°æ‰“å‡ºä¸‰ä¸ªå­—ï¼šã€Œå¥½åƒçš„ã€‚ã€</p>
<p>å‘å‡ºå»ä¹‹åï¼Œä»–æ”¾ä¸‹æ‰‹æœºï¼Œæœ›ç€å¤©èŠ±æ¿ã€‚ä¹Ÿè®¸ï¼Œä¸€åˆ‡è¿˜æ²¡åˆ°æœ€åçš„æ—¶å€™ã€‚ä¹Ÿè®¸ï¼Œè¿˜æœ‰ä»€ä¹ˆå€¼å¾—æœŸå¾…çš„äº‹æƒ…æ­£åœ¨å‰æ–¹ç­‰ç€ä»–ã€‚</p>
<p>çª—å¤–ï¼Œä¸€è¾†å…¬è½¦ç¼“ç¼“é©¶è¿‡ï¼Œå¸¦èµ·ä¸€é˜µè½»è½»çš„é£ã€‚</p>`;

const CH16_TEXT = `<p class="ch-title">ç¬¬åå…­ç« ã€€å‘Šåˆ«</p>
<p>é‚£æ˜¯ä¸€ä¸ªéš¾å¾—çš„æ™´å¤©ã€‚é™†æ²‰ç«™åœ¨æœºåœºå‡ºå‘å…ï¼ŒèƒŒç€ä¸€ä¸ªå¹¶ä¸é‡çš„è¡Œå›Šï¼Œå´æ„Ÿè§‰æœ‰ä»€ä¹ˆä¸œè¥¿å‹å¾—ä»–å–˜ä¸è¿‡æ°”æ¥ã€‚</p>
<p>æ—é›¨æŸ”æ²¡æœ‰æ¥é€è¡Œã€‚å¥¹å‘äº†ä¸€æ¡æ¶ˆæ¯ï¼šã€Œè·¯ä¸Šæ³¨æ„å®‰å…¨ã€‚ã€å°±å†æ²¡æœ‰ä¸‹æ–‡ã€‚</p>
<p>ç™»æœºå£çš„å¹¿æ’­ä¸€éä¸€éåœ°æ’­æŠ¥ç€èˆªç­ä¿¡æ¯ã€‚é™†æ²‰æ‹¿å‡ºç™»æœºç‰Œï¼Œçœ‹äº†çœ‹ï¼Œåˆæ”¶äº†å›å»ã€‚æ£€ç¥¨å£è¶Šæ¥è¶Šè¿‘äº†ã€‚</p>
<p>ä»–æ‰“å¼€æ‰‹æœºï¼Œç¿»åˆ°æ—é›¨æŸ”çš„å¤´åƒï¼Œæƒ³å‘ä¸€æ¡æ¶ˆæ¯ï¼Œå´ä¸çŸ¥é“è¯¥è¯´ä»€ä¹ˆã€‚æœ€åï¼Œä»–åªæ˜¯æŠŠæ‰‹æœºæ”¾äº†å›å»ï¼Œè·Ÿç€äººæµï¼Œä¸€æ­¥ä¸€æ­¥åœ°èµ°å‘ç™»æœºå£ã€‚</p>`;

let currentChapter = 16; // 0-indexed
let currentFontSize = 16;
let contactName = 'å°ç¾ğŸŒ¸';
let contactEmoji = 'ğŸŒ¸';
let currentScreen = 'reading';
let bossKeyReturnsTo = 'reading';

const chapterTexts = {};
CHAPTERS.forEach((ch, i) => {
  if (i === 16) chapterTexts[i] = CH17_TEXT;
  else if (i === 17) chapterTexts[i] = CH18_TEXT;
  else if (i === 15) chapterTexts[i] = CH16_TEXT;
  else chapterTexts[i] = `<p class="ch-title">${ch.title}</p><p>ï¼ˆæ­¤ç« èŠ‚å†…å®¹åŠ è½½ä¸­â€¦â€¦ï¼‰</p>`;
});

// â”€â”€â”€ Screen Nav â”€â”€â”€
function goTo(id, direction='forward') {
  const screens = document.querySelectorAll('.screen');
  screens.forEach(s => {
    if (s.id === 'screen-' + id) {
      s.classList.remove('exit-left','exit-right');
      s.classList.add('active');
    } else if (s.classList.contains('active')) {
      s.classList.remove('active');
      s.classList.add(direction === 'forward' ? 'exit-left' : 'exit-right');
      setTimeout(() => s.classList.remove('exit-left','exit-right'), 300);
    }
  });
  currentScreen = id;
  updateFlowDots();
}

function updateFlowDots() {
  document.querySelectorAll('.flow-dot').forEach(d => {
    d.classList.toggle('active', d.dataset.screen === currentScreen);
  });
}

// â”€â”€â”€ Init â”€â”€â”€
function initBubble() {
  const bc = document.getElementById('bubble-content');
  bc.innerHTML = chapterTexts[currentChapter];
  bc.style.fontSize = currentFontSize + 'px';
  bc.scrollTop = 0;
}

function initChapterList(filter = '') {
  const list = document.getElementById('ch-list');
  const summary = document.getElementById('ch-summary');
  const readCount = CHAPTERS.filter(c => c.status === 'read').length;
  summary.textContent = `å…± ${CHAPTERS.length} ç«  Â· å·²è¯» ${readCount} ç«  Â· å½“å‰ç¬¬ ${currentChapter + 1} ç« `;

  const filtered = CHAPTERS.map((ch, i) => ({...ch, i}))
    .filter(ch => !filter || ch.title.includes(filter));

  list.innerHTML = '';
  if (filtered.length === 0) {
    list.innerHTML = `<div class="ch-empty" style="padding:40px 20px;text-align:center;color:#C8C8C8;font-size:14px;">æ²¡æœ‰æ‰¾åˆ°"${filter}"</div>`;
    return;
  }

  filtered.forEach(({title, status, i}) => {
    const isCur = i === currentChapter;
    const isRead = status === 'read';
    // PRD Â§2.3: å½“å‰ç« èŠ‚è“è‰²+è“ç‚¹ï¼Œå·²è¯»ç°è‰²+ç°è‰²å‹¾ï¼Œæœªè¯»é»‘è‰²å­—ä½“
    const statusMark = isCur ? 'ğŸ”µ' : isRead ? 'âœ“' : '';
    const statusColor = isCur ? 'var(--blue)' : '#BBBBBB';

    const div = document.createElement('div');
    div.className = 'ch-item' + (isCur ? ' cur' : '') + (isRead ? ' read' : '');
    div.innerHTML = `
      <div style="flex:1;min-width:0;padding:16px 0;">
        <div class="ch-name">${title}</div>
      </div>
      <span style="font-size:12px;color:${statusColor};margin-left:12px;flex-shrink:0;">${statusMark}</span>
    `;
    div.addEventListener('click', () => jumpToChapter(i));
    list.appendChild(div);
  });

  // PRD: auto-scroll current chapter to screen center
  setTimeout(() => {
    const cur = list.querySelector('.ch-item.cur');
    if (cur) cur.scrollIntoView({block: 'center', behavior: 'smooth'});
  }, 120);
}

function jumpToChapter(idx) {
  currentChapter = idx;
  // PRD: ç›®å½•é¡µé€€å‡ºï¼Œé˜…è¯»ç•Œé¢å®šä½åˆ°è¯¥ç« èŠ‚é¦–è¡Œï¼Œ< 0.2s
  goTo('reading', 'back');
  setTimeout(() => {
    const bc = document.getElementById('bubble-content');
    bc.innerHTML = chapterTexts[idx] || `<p class="ch-title">${CHAPTERS[idx].title}</p><p>æ­¤ç« èŠ‚å†…å®¹æš‚æ— ã€‚</p>`;
    bc.style.fontSize = currentFontSize + 'px';
    bc.scrollTop = 0;
    // scroll chat to reading bubble
    const row = document.getElementById('reading-row');
    if (row) row.scrollIntoView({block:'start'});
    showToast('toast-reading', `å·²è·³è½¬ï¼š${CHAPTERS[idx].title}`);
    initChapterList();
  }, 200);
}

// â”€â”€â”€ Menu â”€â”€â”€
const ctxMenu = document.getElementById('ctx-menu');
const dimReading = document.getElementById('dim-reading');
let menuOpen = false;

function openMenu() {
  menuOpen = true;
  ctxMenu.classList.add('open');
  dimReading.classList.add('show');
}
function closeMenu() {
  menuOpen = false;
  ctxMenu.classList.remove('open');
  if (!chPanelOpen && !fontSheetOpen) dimReading.classList.remove('show');
}

document.getElementById('btn-menu').addEventListener('click', (e) => {
  e.stopPropagation();
  menuOpen ? closeMenu() : openMenu();
});

document.getElementById('menu-shelf').addEventListener('click', () => {
  closeMenu();
  setTimeout(() => goTo('shelf'), 100);
});
document.getElementById('menu-contact').addEventListener('click', () => {
  closeMenu();
  setTimeout(() => goTo('contact'), 100);
});
document.getElementById('menu-selfavatar').addEventListener('click', () => {
  closeMenu();
  showToast('toast-reading', 'ğŸ˜Š è‡ªå·±å¤´åƒè®¾ç½®ï¼ˆè”ç³»äººè®¾ç½®é¡µå³ä¾§å¤´åƒï¼‰', 2500);
  setTimeout(() => goTo('contact'), 600);
});
document.getElementById('menu-chatcustom').addEventListener('click', () => {
  closeMenu();
  showToast('toast-reading', 'ğŸ’¬ èŠå¤©å†…å®¹è‡ªå®šä¹‰ â€” MVPé˜¶æ®µå¯ç¼–è¾‘é»˜è®¤å¯¹è¯', 2500);
});
document.getElementById('menu-mode').addEventListener('click', () => {
  closeMenu();
  showToast('toast-reading', 'ğŸ§­ å·²åˆ‡æ¢åˆ°ã€Œæ°”æ³¡é˜…è¯»æ¨¡å¼ã€', 1800);
});
document.getElementById('menu-import').addEventListener('click', () => {
  closeMenu();
  simulateImportFlow('toast-reading');
});
document.getElementById('menu-font').addEventListener('click', () => {
  closeMenu();
  setTimeout(openFontSheet, 50);
});

// Close menu on dim click
dimReading.addEventListener('click', () => {
  closeMenu();
  closeFontSheet();
});

// â”€â”€â”€ Chapter Screen (full-screen, PRD Â§2.3) â”€â”€â”€
let chPanelOpen = false; // kept for compat

function openChapterPanel() {
  chPanelOpen = true;
  document.getElementById('ch-search-input').value = '';
  initChapterList();
  // Full-screen push from right, < 0.3s
  goTo('chapter', 'forward');
}

function closeChapterPanel() {
  chPanelOpen = false;
  goTo('reading', 'back');
}

document.getElementById('ch-search-input').addEventListener('input', (e) => {
  initChapterList(e.target.value.trim());
});

document.getElementById('chapter-back').addEventListener('click', () => {
  goTo('reading', 'back');
});

// PRD Â§2.3: ç‚¹ç©ºç™½åŒºåŸŸè¿”å›ï¼ˆä¸è·³è½¬ç« èŠ‚ï¼‰
document.getElementById('screen-chapter').addEventListener('click', (e) => {
  const t = e.target;
  const block = t.closest('.ch-item, .nav-bar, .status-bar, .ch-search, #ch-summary');
  if (!block) closeChapterPanel();
});

// PRD Â§2.3: ä»å·¦è¾¹ç¼˜å³æ»‘è¿”å›
const chapterScreen = document.getElementById('screen-chapter');
let chapterEdgeStartX = -1;
let chapterEdgeStartY = -1;

chapterScreen.addEventListener('touchstart', (e) => {
  if (!e.touches || !e.touches[0]) return;
  const touch = e.touches[0];
  chapterEdgeStartX = touch.clientX <= 24 ? touch.clientX : -1;
  chapterEdgeStartY = touch.clientY;
}, { passive: true });

chapterScreen.addEventListener('touchend', (e) => {
  if (chapterEdgeStartX < 0 || !e.changedTouches || !e.changedTouches[0]) return;
  const touch = e.changedTouches[0];
  const deltaX = touch.clientX - chapterEdgeStartX;
  const deltaY = Math.abs(touch.clientY - chapterEdgeStartY);
  if (deltaX > 70 && deltaY < 45) closeChapterPanel();
  chapterEdgeStartX = -1;
  chapterEdgeStartY = -1;
}, { passive: true });

// Long press avatar
let lpTimer = null;
let lpProgress = 0;
const avatar = document.getElementById('avatar');
const lpRing = document.getElementById('lp-ring');
const lpCircle = lpRing.querySelector('circle');

function startLongPress() {
  // position ring over actual avatar
  const av = document.getElementById('avatar');
  const phone = document.querySelector('.phone');
  const avRect = av.getBoundingClientRect();
  const phoneRect = phone.getBoundingClientRect();
  lpRing.style.top = (avRect.top - phoneRect.top) + 'px';
  lpRing.style.left = (avRect.left - phoneRect.left) + 'px';

  lpRing.classList.add('filling');
  lpTimer = setTimeout(() => {
    endLongPress();
    openChapterPanel();
  }, 550);
}
function endLongPress() {
  clearTimeout(lpTimer);
  lpTimer = null;
  setTimeout(() => lpRing.classList.remove('filling'), 200);
}

avatar.addEventListener('mousedown', startLongPress);
avatar.addEventListener('touchstart', (e) => { e.preventDefault(); startLongPress(); }, {passive:false});
avatar.addEventListener('mouseup', endLongPress);
avatar.addEventListener('mouseleave', endLongPress);
avatar.addEventListener('touchend', endLongPress);

// â”€â”€â”€ Font Sheet â”€â”€â”€
const fontSheet = document.getElementById('font-sheet');
let fontSheetOpen = false;

function openFontSheet() {
  fontSheetOpen = true;
  fontSheet.classList.add('open');
  dimReading.classList.add('show');
}
function closeFontSheet() {
  fontSheetOpen = false;
  fontSheet.classList.remove('open');
  if (!menuOpen && !chPanelOpen) dimReading.classList.remove('show');
}

document.getElementById('font-sheet-close').addEventListener('click', closeFontSheet);

document.querySelectorAll('.font-opt').forEach(opt => {
  opt.addEventListener('click', () => {
    document.querySelectorAll('.font-opt').forEach(o => o.classList.remove('sel'));
    opt.classList.add('sel');
    currentFontSize = parseInt(opt.dataset.size);
    document.getElementById('bubble-content').style.fontSize = currentFontSize + 'px';
    showToast('toast-reading', `å­—ä½“å·²è°ƒæ•´ï¼š${opt.textContent}`);
    setTimeout(closeFontSheet, 600);
  });
});

// â”€â”€â”€ Boss Key â”€â”€â”€
const flash = document.getElementById('flash');

document.getElementById('btn-boss').addEventListener('click', () => {
  bossKeyReturnsTo = currentScreen;
  flash.classList.add('flash');
  setTimeout(() => {
    flash.classList.remove('flash');
    goTo('boss', 'forward');
    const t = document.getElementById('toast-boss');
    t.textContent = 'ç‚¹å‡»ä»»æ„å¤„è¿”å›é˜…è¯»';
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 2000);
  }, 80);
});

document.getElementById('screen-boss').addEventListener('click', () => {
  goTo('reading', 'back');
});

// Shake detection
let lastX = 0, lastY = 0, lastZ = 0, lastShake = 0;
if (window.DeviceMotionEvent) {
  window.addEventListener('devicemotion', (e) => {
    const a = e.accelerationIncludingGravity;
    if (!a) return;
    const now = Date.now();
    if (now - lastShake < 1000) return;
    const dx = Math.abs(a.x - lastX), dy = Math.abs(a.y - lastY), dz = Math.abs(a.z - lastZ);
    if (dx + dy + dz > 30 && currentScreen === 'reading') {
      lastShake = now;
      document.getElementById('btn-boss').click();
    }
    lastX = a.x; lastY = a.y; lastZ = a.z;
  });
}

// â”€â”€â”€ Bookshelf â”€â”€â”€
document.getElementById('shelf-back').addEventListener('click', () => goTo('reading', 'back'));
document.querySelectorAll('.book-card').forEach(card => {
  card.addEventListener('click', () => {
    const idx = card.dataset.book;
    if (idx === undefined) return;
    document.querySelectorAll('.book-card').forEach(c => c.classList.remove('active-book'));
    card.classList.add('active-book');
    showToast('toast-shelf', `å·²åˆ‡æ¢ï¼š${card.querySelector('.book-title').textContent}`);
    setTimeout(() => goTo('reading', 'back'), 800);
  });
});
document.getElementById('shelf-import').addEventListener('click', () => {
  simulateImportFlow('toast-shelf');
});

// â”€â”€â”€ Contact â”€â”€â”€
document.getElementById('contact-back').addEventListener('click', () => goTo('reading', 'back'));

let selfEmoji = 'ğŸ˜Š';

document.getElementById('contact-save').addEventListener('click', () => {
  const name = document.getElementById('contact-name-input').value.trim() || 'å°ç¾';
  contactName = name;
  contactEmoji = document.getElementById('avatar-emoji').textContent;
  document.getElementById('contact-name-display').textContent = contactName;
  document.getElementById('avatar').textContent = contactEmoji;
  // sync all other-party avatars
  document.querySelectorAll('.avatar-static').forEach(a => a.textContent = contactEmoji);
  showToast('toast-contact', 'âœ“ è®¾ç½®å·²ä¿å­˜');
  setTimeout(() => goTo('reading', 'back'), 700);
});

// Emoji picker
const emojiGrid = document.getElementById('emoji-grid');
const emojiPicker = document.getElementById('emoji-picker');
EMOJIS.forEach(e => {
  const btn = document.createElement('div');
  btn.textContent = e;
  btn.style.cssText = 'font-size:26px;text-align:center;cursor:pointer;padding:6px;border-radius:8px;transition:background 0.12s;';
  btn.addEventListener('click', () => {
    document.getElementById('avatar-emoji').textContent = e;
    document.getElementById('avatar-big').style.background = '';
    emojiPicker.style.display = 'none';
  });
  btn.addEventListener('mouseover', () => btn.style.background = '#F5F5F5');
  btn.addEventListener('mouseout', () => btn.style.background = '');
  emojiGrid.appendChild(btn);
});
document.getElementById('avatar-picker').addEventListener('click', () => {
  emojiPicker.style.display = emojiPicker.style.display === 'none' ? 'block' : 'none';
});

// â”€â”€â”€ Flow dots â”€â”€â”€
document.querySelectorAll('.flow-dot').forEach(d => {
  d.addEventListener('click', () => {
    const target = d.dataset.screen;
    if (target !== currentScreen) goTo(target, 'forward');
  });
});

// â”€â”€â”€ Toast â”€â”€â”€
function showToast(id, msg, dur = 2000) {
  const t = document.getElementById(id);
  if (!t) return;
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), dur);
}

// â”€â”€â”€ Import Flow (PRD é¦–æ¬¡å¯¼å…¥æµç¨‹æ¼”ç¤º) â”€â”€â”€
function simulateImportFlow(toastId) {
  const steps = [
    'ğŸ“„ æ–‡ä»¶é€‰æ‹©å™¨å·²æ‰“å¼€',
    'â³ æ­£åœ¨å¯¼å…¥ TXTï¼ˆè‡ªåŠ¨è¯†åˆ« UTF-8 / GBKï¼‰â€¦',
    'ğŸ§© æ­£åœ¨è§£æç« èŠ‚ç›®å½•â€¦',
    'âœ… å¯¼å…¥å®Œæˆï¼Œå·²æ¢å¤åˆ°é˜…è¯»é¡µ'
  ];
  let i = 0;
  const run = () => {
    showToast(toastId, steps[i], i === steps.length - 1 ? 1800 : 1100);
    if (i < steps.length - 1) {
      i += 1;
      setTimeout(run, 850);
    }
  };
  run();
}

// â”€â”€â”€ Live Time â”€â”€â”€
function updateTime() {
  const now = new Date();
  const h = now.getHours(), m = now.getMinutes();
  const str = `${h}:${String(m).padStart(2,'0')}`;
  document.querySelectorAll('#live-time, #live-time-boss').forEach(el => el && (el.textContent = str));
}
updateTime();
setInterval(updateTime, 10000);

// â”€â”€â”€ Init â”€â”€â”€
initBubble();
initChapterList();
updateFlowDots();

// Scroll chat to reading bubble
setTimeout(() => {
  const row = document.getElementById('reading-row');
  if (row) row.scrollIntoView({behavior:'smooth', block:'start'});
}, 400);

// Welcome toast
setTimeout(() => showToast('toast-reading', 'ğŸ’¡ ç‚¹ã€Œ+ã€è€æ¿é”®ï½œé•¿æŒ‰å¤´åƒçœ‹ç›®å½•', 3000), 800);
</script>
</body>
</html>
